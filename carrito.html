<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Arima:wght@100..700&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
        <script src="https://kit.fontawesome.com/ea3a23785c.js" crossorigin="anonymous"></script>
    
        <link rel="stylesheet" href="./style.css">
        <title>Productos</title>
    </head>
    <body>
        
    </body>
    </html>
    <title>Document</title>
</head>
<body>
    <header>
        <img src="img/logo.png" alt="">
        <nav>
            <ul>
                <li><a href="./index.html">INICIO</a></li>
                <li><a href="./productos.html">PRODUCTOS</a></li>
                <li><a href="./resena.html">RESEÑAS</a></li>
                <li><a href="./contacto.html">CONTACTO</a></li>
                <li><i class="fa-solid fa-cart-shopping"></i></li>
                <li><a href="./carrito.html"><i class="fi fi-rr-shopping-cart-add" name ="carrito"></i></a></li>
                
            </ul>
        </nav>
    </header>
    <section>
        <h1>Categorias</h1>
        <ul class="categorias">
            <li><a href="">categoria1</a></li>
            <li><a href="">categoria2</a></li>
            <li><a href="">categoria3</a></li>
            <li><a href="">categoria4</a></li>
            <li><a href="">categoria5</a></li>
            <li><a href="">categoria6</a></li>
            <li><a href="">categoria7</a></li>
            <li><a href="">categoria8</a></li>
            <li><a href="">categoria9</a></li>
            <li><a href="">categoria10</a></li>
        </ul>
    </section>
    <main>
        <div class="productos" id ="areaproductos">
            
          
        </div>
        <div class ="pagoTotal">
            <p>Total A Pagar $<span id="pagoTotal"></span></p>
            <p><input type="button" value="Pagar" name="pagar"></p>
            <p><input type="button" value="Vaciar carrito" name="vaciarCarro"></p>
        </div>




<script>
    class ArticuloProducto{
        constructor(data, cantidad){
            this.nombre = data.nombre
            this.nro_de_orden = data.nro_de_orden;
            this.id_unico = data.id_unico;
            this.imagen = data.imagen;
            this.precio = data.precio;
            this.medidas = data.medidas;
            this.descripcion = data.descripcion;
            this.cantidad = cantidad;
        }
        
        crea_html(){
            let articulo = document.createElement("article");
            articulo.setAttribute("class", "articuloProducto");
            let foto = '<div class="fotoProducto"><img src="'+this.imagen+'" alt="" ></div>';
            let nombre = '<div class="tituloProducto">'+this.nombre+'</div>';
            let descripcion = '<div class="descripcionProducto">'+this.descripcion+'</div>';
            let precio = '<div class="precioProducto">'+this.precio+'</div>';
            let cantidad  = '<div class="areacantidad"><input type="number" name="cantidad" value ="'+this.cantidad+'" data-id_producto="'+this.id_unico+'" onblur="CambiarCantidad(this)" min="0" max="1000"></div>';

            let texto = foto+nombre+descripcion+precio+cantidad;
            articulo.innerHTML= texto;
            return articulo;
        }
        
        
    }
//crear evento click en los botones nombre
    function agrega_producto(elemento){
        
        productosumado = elemento.dataset.id_producto;
        console.log(productosumado);
        variableSesion = sessionStorage.getItem("productosAgregados");
        if(variableSesion!=null){
            console.log("entro al if");
            let arrayAgregados = variableSesion.split(",");
            let arrayAgregadosLimpio = arrayAgregados.map(function(e){return e.trim()})
            //agrego otro elemento con push
            arrayAgregadosLimpio.push(productosumado);
            console.log(arrayAgregadosLimpio);
            sessionStorage.productosAgregados = arrayAgregadosLimpio.join(", ");
        }
        else{
            console.log("entro al else");
            sessionStorage.setItem("productosAgregados", productosumado);
        }


    }
//



//funcion para contar elementos por producto y que sea devuelto como un json


function nuevoAgregarProducto(elemento){
    nuevoProducto = elemento.dataset.id_producto;
    cadena = sessionStorage.productos;
    if(cadena ==null){
        sessionStorage.setItem("productos", "{}");
        cadena = sessionStorage.productos;
    }

    jsonProductos = JSON.parse(cadena);
    if(nuevoProducto in jsonProductos){
        jsonProductos[nuevoProducto] += 1;
    }
    else{
        jsonProductos[nuevoProducto] = 1;
    }
    sessionStorage.productos = JSON.stringify(jsonProductos);

}



function modificarCantidades(id, cantidad) {
    try {
        let cadena = sessionStorage.productos;
        let id_producto = id;
        let cantidad_producto = Number(cantidad);

        if (isNaN(cantidad_producto)) {
            throw new Error("La cantidad debe ser un número válido");
        }

        if(cadena == null) {
            sessionStorage.setItem("productos", "{}");
            cadena = sessionStorage.productos;
        }

        let jsonProductos = JSON.parse(cadena);
        jsonProductos[id_producto] = cantidad_producto;
        sessionStorage.productos = JSON.stringify(jsonProductos);
        sumarTotal();
        
    } catch (error) {
        console.error("Error al modificar cantidades:", error);
    }
}

function CambiarCantidad(elemento){
    let id_unico = elemento.dataset.id_producto;
    let cantidad = elemento.value;
    modificarCantidades(id_unico, cantidad);
}

function actualizarTotal(){

    let area_total = document.getElementById("pagoTotal");
    let nuevovalor = sessionStorage.getItem("total");
    area_total.innerHTML = nuevovalor;

}
async function sumarTotal() {
    try {
        let cadena = sessionStorage.productos;
        if(cadena == null) {
            sessionStorage.setItem("productos", "{}");
            cadena = sessionStorage.productos;
        }
        
        let arrayProductos = JSON.parse(cadena);
        const response = await fetch("./productos/productos.json");
        const data = await response.json();
        
        let totalSuma = 0;
        const arrayClaves = Object.keys(arrayProductos);
        
        arrayClaves.forEach(clave => {
            const producto = data.productos.find(p => p.id_unico === clave);
            if (producto) {
                totalSuma += producto.precio * arrayProductos[clave];
            }
        });
        
        sessionStorage.setItem("total", totalSuma);
        actualizarTotal(); 
        
    } catch (error) {
        console.error("Error al calcular el total:", error);
    }
}
//
    function crea_articulos(data, cantidad){
        divArticle = new ArticuloProducto(data, cantidad);
        divPadre = document.getElementById("areaproductos");
        divPadre.append(divArticle.crea_html())
    }
////////////////////////////////
////////////////////////////////


    fetch("./productos/productos.json")
        .then(data=>data.json())
        .then(data=>{
            //console.log(data.productos)
            data.productos.forEach(producto => {

                cadena = sessionStorage.productos;
                if(cadena ==null){
                    sessionStorage.setItem("productos", "{}");
                    cadena = sessionStorage.productos;
                }

                jsonProductos = JSON.parse(cadena);

                if(producto.id_unico in jsonProductos && jsonProductos[producto.id_unico]!=0){
                    crea_articulos(producto, jsonProductos[producto.id_unico]);
                }

            });
        })
//hago la solicitud de la pagina
sumarTotal();


    
</script>


    </main>
    <footer>
        <div>
            <h3>Dónde estamos:</h3>
            <div>
                <iframe src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d4771.912631719059!2d-58.584333753951974!3d-34.750720552740795!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1ses-419!2sar!4v1730064748686!5m2!1ses-419!2sar" width="200" height="200" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>    
            </div>
        </div>

        <div>
            <h3>Nuestras Redes:</h3>
            <div class="redes">
                <i class="fi fi-brands-tik-tok"></i>
                <i class="fi fi-brands-facebook"></i>
                <i class="fi fi-brands-whatsapp"></i>
                <i class="fi fi-brands-instagram"></i>
                <i class="fi fi-brands-twitter-alt"></i>

            </div>
        </div>
        
    </footer>
</body>
</html>